# ARIMA 存储空间使用率预测系统修改说明

## 概述
已将原有的通用时间序列预测系统修改为专门针对存储空间使用率数据的ARIMA预测系统。主要特点：

- 专门处理 `tb_metric_raw_free_space_ratio_202509161435.csv` 数据文件
- 使用ARIMA模型进行单一模型的训练和推理
- 支持训练数据、验证数据和推理数据的合理显示
- 提供相关的评估指标和可视化

## 主要修改内容

### 1. 后端修改 (`backend/app.py`)

#### 数据处理
- **新增数据加载函数**：`load_metric_data()` 专门处理存储空间使用率数据
- **数据清洗**：自动过滤无效数据（value > 0），去除连接失败的记录
- **设备选择**：自动选择数据最完整的设备进行预测
- **数据聚合**：按小时聚合数据，提高预测效果

#### ARIMA模型
- **专用ARIMA模型**：移除其他模型，专注于ARIMA(p,d,q)
- **参数配置**：支持自定义p、d、q参数
- **模型训练**：独立的训练接口 `/api/train`
- **模型推理**：独立的预测接口 `/api/predict`

#### 新增API接口
```python
POST /api/train         # 训练ARIMA模型
POST /api/predict       # 使用训练好的模型预测
POST /api/forecast      # 完整的训练和预测流程（向后兼容）
GET  /api/data/info     # 获取数据信息
GET  /api/data/preview  # 预览数据
```

#### 评估指标
- **MAPE**: 平均绝对百分比误差
- **RMSE**: 均方根误差
- **MAE**: 平均绝对误差
- **MSE**: 均方误差

### 2. 前端修改

#### HTML界面 (`frontend/index.html`)
- **按钮分离**：将训练和预测分成独立按钮
- **参数输入**：添加ARIMA参数(p,d,q)输入框
- **预测周期**：修改为小时单位（1-168小时）
- **移除多变量选项**：专注于单变量预测

#### JavaScript功能 (`frontend/js/app.js`)
- **新增功能**：
  - `trainModel()`: 训练ARIMA模型
  - `runPrediction()`: 运行预测
  - `loadDataInfo()`: 加载数据信息
  - `updateModelParameters()`: 更新模型参数输入
- **状态管理**：跟踪模型训练状态
- **参数验证**：验证ARIMA参数输入

#### 图表显示 (`frontend/js/charts.js`)
- **四条数据线**：
  - 训练数据（蓝色实线）
  - 验证数据（绿色实线）
  - 验证预测（绿色虚线）
  - 未来预测（黄色虚线）
- **数据单位**：显示使用率百分比
- **时间格式**：支持小时级别时间显示

#### 样式更新 (`frontend/css/style.css`)
- **按钮组样式**：支持多个按钮水平排列
- **参数输入样式**：ARIMA参数网格布局
- **状态样式**：训练/预测按钮状态

### 3. 数据处理流程

#### 数据预处理
1. 读取CSV文件：`tb_metric_raw_free_space_ratio_202509161435.csv`
2. 时间格式转换：将time列转换为datetime
3. 数据过滤：去除value <= 0的无效数据
4. 设备选择：选择数据最完整的设备
5. 时间聚合：按小时聚合，取平均值

#### 模型训练流程
1. 数据划分：80%训练，20%验证
2. ARIMA训练：使用指定的(p,d,q)参数
3. 模型评估：在验证集上计算指标
4. 结果返回：训练数据、验证数据、预测结果、评估指标

#### 预测流程
1. 使用训练好的模型
2. 预测指定的未来时间点
3. 计算置信区间（基于训练数据标准差）
4. 返回预测结果

### 4. 使用方法

#### 基本操作
1. **选择模型**：选择ARIMA模型
2. **设置参数**：调整p、d、q参数（默认2,1,2）
3. **训练模型**：点击"训练模型"按钮
4. **查看结果**：观察训练数据、验证数据和评估指标
5. **运行预测**：点击"运行预测"按钮，设置预测周期
6. **查看预测**：观察未来预测结果

#### 一键预测
- 点击"一键预测"按钮，自动完成训练和预测流程

### 5. 技术特点

#### 数据处理
- **自动化**：自动选择最佳设备和数据清洗
- **灵活性**：支持不同时间粒度的聚合
- **健壮性**：处理缺失值和异常值

#### 模型特性
- **专业性**：专门针对存储空间使用率优化
- **可配置**：支持ARIMA参数调优
- **可扩展**：架构支持后续添加其他算法

#### 可视化
- **清晰性**：明确区分训练、验证、预测数据
- **交互性**：支持缩放、导出等功能
- **信息量**：显示详细的统计信息和评估指标

## 文件结构
```
darts_demo/
├── backend/
│   └── app.py                    # 修改后的后端服务
├── frontend/
│   ├── index.html               # 修改后的前端界面
│   ├── js/
│   │   ├── app.js              # 修改后的前端逻辑
│   │   └── charts.js           # 修改后的图表代码
│   └── css/
│       └── style.css           # 修改后的样式
├── data/
│   └── tb_metric_raw_free_space_ratio_202509161435.csv  # 数据文件
├── test_arima.py               # 测试脚本
└── ARIMA_CHANGES.md           # 本说明文件
```

## 运行方式

### 开发环境
```bash
# 启动后端
cd darts_demo
source darts-env/bin/activate
python backend/app.py

# 启动前端（另一个终端）
cd darts_demo/frontend
python3 -m http.server 8080
```

### Docker方式
```bash
cd darts_demo
./start.sh
```

### 测试脚本
```bash
cd darts_demo
source darts-env/bin/activate
python test_arima.py
```

## 访问地址
- 前端界面：http://localhost:8080 或 http://localhost
- 后端API：http://localhost:5001
- 健康检查：http://localhost:5001/api/health

## 注意事项
1. 确保数据文件路径正确
2. 虚拟环境包含所需依赖
3. ARIMA参数选择影响预测效果
4. 预测周期不宜过长（建议≤168小时）