# 时间序列预测系统需求文档

## 1. 项目概述

### 1.1 项目背景
本项目是一个基于 Python Darts 库的时间序列预测系统，专门用于存储空间使用率的预测分析。系统采用前后端分离架构，为用户提供友好的 Web 界面来执行时间序列分析和预测任务。

### 1.2 项目目标
- 提供准确的存储空间使用率预测功能
- 支持多种时间序列预测算法
- 提供直观的可视化界面展示预测结果
- 支持模型性能评估和比较
- 提供易于部署和维护的解决方案

### 1.3 目标用户
- 系统运维工程师
- 数据分析师
- IT 基础设施管理人员
- 容量规划专家

## 2. 功能性需求

### 2.1 核心功能模块

#### 2.1.1 数据管理模块
**功能描述：** 负责时间序列数据的加载、清洗和预处理

**具体需求：**
- **数据加载：** 自动从 data 目录加载 CSV 格式数据文件
- **数据清洗：** 自动过滤无效数据（value ≤ 0）
- **数据预处理：** 时间格式标准化、缺失值处理
- **设备选择：** 自动选择数据最完整的设备进行分析
- **数据聚合：** 支持按小时聚合数据，提高预测效果
- **数据验证：** 检查数据格式和质量

**输入：**
- 位于 data 目录下的 CSV 格式时间序列数据文件
- 包含 time, ci_id, value 字段

**输出：**
- 清洗后的时间序列数据
- 数据质量报告
- 数据统计信息

#### 2.1.2 模型训练模块
**功能描述：** 提供多种时间序列预测模型的训练功能

**具体需求：**
- **ARIMA 模型：** 支持自定义 (p,d,q) 参数
- **指数平滑：** 处理趋势和季节性数据
- **Prophet 模型：** 处理缺失数据和节假日影响
- **Four Theta：** 快速短期预测
- **参数配置：** 支持模型超参数调整
- **训练监控：** 实时显示训练状态和进度

**输入：**
- 预处理后的训练数据
- 模型类型选择
- 模型参数配置

**输出：**
- 训练完成的模型对象
- 训练过程日志
- 模型参数信息

#### 2.1.3 模型预测模块
**功能描述：** 使用训练好的模型进行时间序列预测

**具体需求：**
- **单步预测：** 预测下一个时间点的值
- **多步预测：** 预测未来多个时间点的值（1-168 小时）
- **置信区间：** 提供预测结果的置信区间
- **批量预测：** 支持批量数据的预测处理
- **实时预测：** 支持实时数据流的在线预测

**输入：**
- 训练好的模型
- 预测时长设置
- 历史数据上下文

**输出：**
- 预测值序列
- 置信区间
- 预测时间戳

#### 2.1.4 模型评估模块
**功能描述：** 提供多种模型性能评估指标

**具体需求：**
- **MAPE（平均绝对百分比误差）：** 评估预测精度
- **RMSE（均方根误差）：** 评估预测偏差
- **MAE（平均绝对误差）：** 评估平均偏差
- **MSE（均方误差）：** 评估误差方差
- **方向准确率：** 评估趋势预测准确性
- **模型比较：** 支持多模型性能对比

**输入：**
- 预测结果
- 实际观测值
- 评估指标配置

**输出：**
- 评估指标数值
- 性能评估报告
- 模型排名结果

#### 2.1.5 可视化展示模块
**功能描述：** 提供丰富的图表可视化功能

**具体需求：**
- **时间序列图：** 展示历史数据、验证数据和预测结果
- **多线图表：** 同时显示训练、验证、预测数据
- **交互功能：** 支持缩放、平移、导出功能
- **实时更新：** 动态更新图表内容
- **主题切换：** 支持多种图表主题
- **全屏显示：** 支持全屏查看图表

**输入：**
- 时间序列数据
- 预测结果
- 图表配置参数

**输出：**
- 交互式图表
- 图表导出文件
- 可视化报告

### 2.2 用户界面需求

#### 2.2.1 控制面板
- **模型选择下拉框：** 选择预测算法
- **参数输入框：** 设置模型参数和预测周期
- **操作按钮：** 训练模型、运行预测、一键预测
- **进度显示：** 显示任务执行状态和进度

#### 2.2.2 数据展示区
- **数据信息：** 显示数据基本统计信息
- **加载状态：** 显示数据加载结果
- **数据预览：** 预览加载的数据内容

#### 2.2.3 结果展示区
- **图表区域：** 主要的可视化展示区域
- **评估指标：** 卡片式显示各项评估指标
- **模型信息：** 显示模型详细信息和参数

#### 2.2.4 辅助功能
- **帮助文档：** 提供使用说明和帮助信息
- **系统信息：** 显示系统版本和技术栈信息
- **错误提示：** 友好的错误信息显示

### 2.3 API 接口需求

#### 2.3.1 健康检查接口
``http
GET /api/health
```
**功能：** 检查系统服务状态
**响应：** 系统状态、时间戳、版本信息

#### 2.3.2 模型管理接口
``http
GET /api/models
```
**功能：** 获取可用模型列表
**响应：** 模型ID、名称、描述、参数说明

#### 2.3.3 模型训练接口
``http
POST /api/train
```
**功能：** 训练指定模型
**输入：** 模型类型、参数配置、训练比例
**响应：** 训练结果、模型信息、评估指标

#### 2.3.4 模型预测接口
``http
POST /api/predict
```
**功能：** 使用训练好的模型进行预测
**输入：** 预测周期数
**响应：** 预测结果、置信区间

#### 2.3.5 完整预测接口
``http
POST /api/forecast
```
**功能：** 一键完成训练和预测流程
**输入：** 模型参数、预测周期
**响应：** 历史数据、预测结果、评估指标

#### 2.3.6 数据管理接口
``http
GET /api/data/info     # 获取数据信息
GET /api/data/preview  # 预览数据内容
POST /api/upload       # 上传数据文件
```

## 3. 非功能性需求

### 3.1 性能需求
- **响应时间：** API 接口响应时间 < 5秒
- **训练时间：** 模型训练时间 < 30秒
- **预测时间：** 单次预测时间 < 3秒
- **并发支持：** 支持 10 个并发用户
- **数据处理：** 支持处理 10万+ 数据点

### 3.2 可用性需求
- **系统可用性：** 99.5% 以上
- **故障恢复：** 故障后 5 分钟内恢复
- **界面响应：** 界面操作响应时间 < 1秒
- **错误处理：** 提供友好的错误信息

### 3.3 可扩展性需求
- **模型扩展：** 支持新增预测算法
- **数据源扩展：** 支持多种数据源接入
- **部署扩展：** 支持水平扩展部署
- **功能扩展：** 模块化设计，易于功能扩展

### 3.4 安全性需求
- **数据安全：** 上传数据加密传输
- **访问控制：** 支持基础的访问控制
- **输入验证：** 严格的输入参数验证
- **错误处理：** 不暴露系统内部信息

### 3.5 兼容性需求
- **浏览器兼容：** 支持 Chrome、Firefox、Safari、Edge
- **操作系统：** 支持 Linux、macOS、Windows
- **Python 版本：** Python 3.8+
- **数据格式：** 支持 CSV 格式数据

## 4. 技术约束

### 4.1 技术栈
- **后端：** Python Flask + Darts + Pandas + NumPy
- **前端：** HTML5 + JavaScript ES6 + ECharts
- **部署：** Docker + Docker Compose
- **数据处理：** Pandas + NumPy

### 4.2 外部依赖
- **Python 库：** Darts>=0.24.0, Flask>=2.3.0, Pandas>=1.5.0
- **JavaScript 库：** ECharts 5.4.3, Font Awesome 6.0.0
- **容器化：** Docker, Docker Compose

### 4.3 部署环境
- **开发环境：** 本地开发服务器
- **生产环境：** Docker 容器化部署
- **端口配置：** 前端 80/8080，后端 5001
- **数据存储：** 本地文件系统

## 5. 用户场景

### 5.1 主要用户场景

#### 5.1.1 日常监控场景
**用户角色：** 系统运维工程师
**使用场景：** 每日检查存储空间使用率趋势
**操作流程：**
1. 打开预测系统界面
2. 查看最新的存储使用率数据
3. 运行短期预测（24小时）
4. 查看预测结果和告警信息
5. 根据预测结果制定维护计划

#### 5.1.2 容量规划场景
**用户角色：** IT 基础设施管理人员
**使用场景：** 制定中长期存储容量规划
**操作流程：**
1. 上传历史存储使用数据
2. 选择合适的预测模型
3. 配置预测参数（预测1周）
4. 训练模型并评估性能
5. 生成预测报告用于容量规划

#### 5.1.3 异常分析场景
**用户角色：** 数据分析师
**使用场景：** 分析存储使用率异常波动
**操作流程：**
1. 导入包含异常时期的数据
2. 使用多种模型进行训练
3. 比较不同模型的预测效果
4. 分析预测误差和异常原因
5. 优化预测模型参数

### 5.2 异常场景处理

#### 5.2.1 数据质量问题
- **缺失数据：** 系统自动识别并进行插值处理
- **异常值：** 自动检测并处理极端异常值
- **格式错误：** 提供明确的错误提示和修正建议

#### 5.2.2 模型训练失败
- **参数错误：** 提供参数验证和建议值
- **数据不足：** 提示最小数据量要求
- **计算资源：** 提供资源不足的处理建议

#### 5.2.3 预测结果异常
- **预测精度低：** 提供模型调优建议
- **预测范围异常：** 自动检测并提示用户
- **计算超时：** 提供任务状态查询和重试机制

## 6. 数据需求

### 6.1 输入数据格式
``csv
time,ci_id,value
2024-01-01 00:00:00,device_001,65.5
2024-01-01 01:00:00,device_001,66.2
...
```

### 6.2 数据字段说明
- **time：** 时间戳，格式 YYYY-MM-DD HH:MM:SS
- **ci_id：** 设备标识符，字符串类型
- **value：** 存储使用率，浮点数，范围 0-100

### 6.3 数据质量要求
- **时间连续性：** 数据时间间隔规律，建议小时级别
- **数值范围：** 使用率值在 0-100 之间
- **完整性：** 单个设备数据缺失率 < 5%
- **准确性：** 数据来源可靠，无明显错误

### 6.4 数据处理规则
- **数据清洗：** 自动去除 value ≤ 0 的记录
- **设备选择：** 优先选择数据最完整的设备
- **时间聚合：** 支持按分钟、小时、天聚合
- **异常处理：** 使用 IQR 方法检测和处理异常值

## 7. 部署需求

### 7.1 系统要求
- **内存：** 最小 2GB，推荐 4GB+
- **CPU：** 2 核心以上
- **存储：** 10GB 以上可用空间
- **网络：** 支持 HTTP/HTTPS 访问

### 7.2 部署方式

#### 7.2.1 Docker 部署（推荐）
```
# 克隆项目
git clone <repository-url>
cd darts_demo

# 一键启动
./start.sh

# 访问地址
# 前端：http://localhost
# 后端：http://localhost:5001
```

#### 7.2.2 开发环境部署
```
# 后端启动
cd backend
pip install -r requirements.txt
python app.py

# 前端启动
cd frontend
python -m http.server 8080
```

### 7.3 环境配置
- **Python 环境：** 3.8+ 版本
- **Node.js：** 可选，用于前端开发
- **Docker：** 20.0+ 版本
- **浏览器：** 现代浏览器，支持 ES6

## 8. 测试需求

### 8.1 功能测试
- **接口测试：** 验证所有 API 接口功能
- **模型测试：** 验证各种预测模型的训练和预测
- **数据测试：** 验证数据上传和处理功能
- **界面测试：** 验证前端界面交互功能

### 8.2 性能测试
- **负载测试：** 模拟多用户并发访问
- **压力测试：** 测试系统极限处理能力
- **稳定性测试：** 长时间运行稳定性测试

### 8.3 兼容性测试
- **浏览器测试：** 主流浏览器兼容性测试
- **操作系统测试：** 不同操作系统部署测试
- **数据格式测试：** 各种数据格式兼容性测试

### 8.4 测试工具
- **单元测试：** pytest
- **接口测试：** test_api.py 脚本
- **功能测试：** test_arima.py 脚本
- **性能测试：** 自定义压力测试脚本

## 9. 文档需求

### 9.1 用户文档
- **使用手册：** 详细的操作指南
- **快速入门：** 5分钟快速上手教程
- **FAQ：** 常见问题和解决方案
- **API 文档：** 完整的接口说明

### 9.2 技术文档
- **架构设计：** 系统架构和技术选型说明
- **部署指南：** 详细的部署和配置说明
- **开发指南：** 代码结构和开发规范
- **故障排除：** 问题诊断和解决方案

### 9.3 维护文档
- **版本说明：** 版本更新和变更记录
- **监控指南：** 系统监控和告警配置
- **备份策略：** 数据备份和恢复方案
- **安全指南：** 安全配置和最佳实践

## 10. 质量保证

### 10.1 代码质量
- **代码规范：** 遵循 PEP8 Python 编码规范
- **代码审查：** 关键功能代码进行审查
- **单元测试：** 核心功能单元测试覆盖率 > 80%
- **文档注释：** 关键函数和类提供详细注释

### 10.2 系统质量
- **错误处理：** 完善的异常处理机制
- **日志记录：** 详细的系统操作日志
- **监控告警：** 关键指标监控和告警
- **数据备份：** 重要数据定期备份

### 10.3 用户体验
- **界面友好：** 直观易用的用户界面
- **操作简便：** 最少步骤完成核心功能
- **反馈及时：** 实时的操作反馈和状态显示
- **帮助完善：** 完整的帮助文档和提示信息

## 11. 项目约束

### 11.1 时间约束
- **开发周期：** 已完成主要功能开发
- **测试周期：** 建议 1-2 周完整测试
- **部署周期：** 1-3 天完成生产部署
- **维护周期：** 持续维护和优化

### 11.2 资源约束
- **开发资源：** 1-2 名开发人员
- **硬件资源：** 标准服务器配置即可
- **存储资源：** 预留足够数据存储空间
- **网络资源：** 稳定的网络连接

### 11.3 技术约束
- **技术栈限制：** 基于 Python 和 Web 技术
- **平台限制：** 支持主流操作系统
- **依赖限制：** 依赖开源库和框架
- **扩展限制：** 模块化设计支持功能扩展

## 12. 风险评估

### 12.1 技术风险
- **模型性能：** 预测精度可能不满足要求
- **数据质量：** 输入数据质量影响预测效果
- **计算资源：** 大数据量处理可能资源不足
- **兼容性：** 不同环境兼容性问题

### 12.2 业务风险
- **用户接受度：** 用户可能不熟悉操作流程
- **需求变更：** 业务需求可能发生变化
- **数据安全：** 敏感数据泄露风险
- **服务可用性：** 系统故障影响业务连续性

### 12.3 风险缓解措施
- **技术风险：** 提供多种算法选择，完善测试
- **业务风险：** 详细文档，用户培训，安全配置
- **监控预警：** 建立完善的监控和告警机制
- **应急预案：** 制定故障应急处理预案